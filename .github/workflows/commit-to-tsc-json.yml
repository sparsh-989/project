name: Check Commit Author and Display Diff

on:
  push:
    branches:
      - main
    paths:
      - 'tsc.json'

jobs:
  check-author:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16
      - name: Install dependencies
        run: npm ci


      - name: Get previous file version
        run: |
          git show HEAD:tsc.json > prev-tsc.json
          echo "::set-output name=prev-file-path::prev-tsc.json"

      - name: Get commit data and display Git diff
        id: commit-data
        env:
          COMMIT_ID: ${{ github.sha }}
          PREV_FILE: ${{ steps.get-prev-file.outputs.prev-file-path }}
        run: |
          diff=$(git diff --no-color $PREV_FILE tsc.json)
          echo "::set-output name=diff::$diff"
          node .github/workflows/script.js $COMMIT_ID

      - name: Display Git diff
        if: steps.commit-data.outputs.diff != ''
        run: echo "Git diff:${steps.commit-data.outputs.diff}"
