name: Check Commit Author and Display Diff

on:
  push:
    branches:
      - main
    paths:
      - 'tsc.json'

jobs:
  check-author:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16

      - name: Install dependencies
        run: npm ci

      - name: Get parent commit
        id: get-parent-commit
        run: echo "::set-output name=parent-commit::$(git rev-list -n 1 HEAD~ || echo '')"

      - name: Get commit data and display Git diff
        id: commit-data
        env:
          COMMIT_ID: ${{ github.sha }}
          PARENT_COMMIT: ${{ steps.get-parent-commit.outputs.parent-commit }}
        run: |
          if [[ -z "$PARENT_COMMIT" ]]; then
            diff=$(git diff --no-color /dev/null HEAD -- tsc.json)
          else
            diff=$(git diff --no-color $PARENT_COMMIT HEAD -- tsc.json)
          fi
          echo "::set-output name=diff::$diff"
          node .github/workflows/script.js $COMMIT_ID

      - name: Display Git diff
        if: steps.commit-data.outputs.diff != ''
        run: echo "Git diff: ${steps.commit-data.outputs.diff}"
