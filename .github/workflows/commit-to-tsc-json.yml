name: Check Commit Author and Display Diff

on:
  push:
    branches:
      - main
    paths:
      - 'tsc.json'

env:
  NODE_VERSION: 16

jobs:
  check-author:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Get parent commit
        id: parent-commit
        run: echo "::set-env name=PARENT_COMMIT::$(git rev-parse HEAD~)"

      - name: Get previous version of tsc.json
        run: git show ${{ env.PARENT_COMMIT }}:tsc.json > prev-tsc.json
        shell: /usr/bin/bash -e {0}

      - name: Get commit data and display Git diff
        id: commit-data
        env:
          COMMIT_ID: ${{ github.sha }}
        run: |
          diff=$(git diff --no-color prev-tsc.json tsc.json)
          echo "::set-env name=DIFF::$diff"
          node .github/workflows/script.js $COMMIT_ID

      - name: Display Git diff
        if: env.DIFF != ''
        run: echo "Git diff:${{ env.DIFF }}"
